---
import type { CollectionEntry } from "astro:content";
import { getCollection, getEntry, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";

interface Props {
  project: CollectionEntry<"project">;
}

export async function getStaticPaths() {
  const all = await getCollection("project");
  return all.map((entry) => ({
    params: { slug: entry.slug },
    props: { project: entry },
  }));
}

export async function get({ params }: { params: { slug: string } }) {
  const slug = params.slug;
  const entry = await getEntry("project", slug);
  if (!entry) return { status: 404 };
  return { props: { project: entry } };
}

const { project } = Astro.props;
const { Content } = await render(project);
---

<Layout title={project.data.titulo}>
  <section
    class="tw-min-h-screen tw-bg-neutral-950 tw-text-white tw-px-6 tw-py-20 tw-flex tw-flex-col tw-items-center tw-relative"
  >
    <!-- Botón volver atrás -->
    <a
      href="/projects"
      data-track-event="Project Detail Back Click"
      data-track-props={`{"project": "${project.data.titulo}"}`}
      class="tw-absolute tw-top-6 tw-left-6 tw-flex tw-items-center tw-gap-2 tw-bg-neutral-800 hover:tw-bg-neutral-700
              tw-text-white tw-font-semibold tw-rounded-full tw-px-4 tw-py-2 tw-transition-colors tw-shadow-md"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="tw-h-4 tw-w-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"
        ></path>
      </svg>
      Back
    </a>

    <!-- Botones GitHub y Demo -->
    <div class="tw-absolute tw-top-6 tw-right-6 tw-flex tw-gap-3">
      {
        project.data.githubUrl && (
          <a
            href={project.data.githubUrl}
            target="_blank"
            rel="noopener noreferrer"
            data-track-event="Project Detail Github Click"
            data-track-props={`{"project": "${project.data.titulo}"}`}
            class="tw-inline-flex tw-items-center tw-gap-2 tw-bg-[#5227FF] hover:tw-bg-[#6a44ff]
                  tw-text-white tw-font-medium tw-rounded-full tw-px-5 tw-py-2 tw-transition-colors tw-shadow-md"
          >
            <img
              src="/github.png"
              alt="GitHub"
              class="tw-w-5 tw-h-5 tw-object-contain"
            />
            GitHub
          </a>
        )
      }

      {
        project.data.projectUrl && (
          <a
            href={project.data.projectUrl}
            target="_blank"
            rel="noopener noreferrer"
            data-track-event="Project Detail Demo Click"
            data-track-props={`{"project": "${project.data.titulo}"}`}
            class="tw-inline-flex tw-items-center tw-gap-2 tw-bg-white hover:tw-bg-gray-200
                  tw-text-black tw-font-medium tw-rounded-full tw-px-5 tw-py-2 tw-transition-colors tw-shadow-md"
          >
            Demo
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="tw-h-4 tw-w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17 8l4 4m0 0l-4 4m4-4H3"
              />
            </svg>
          </a>
        )
      }
    </div>

    <!-- Contenido principal -->
    <div
      class="tw-max-w-5xl tw-w-full tw-flex tw-flex-col tw-gap-4 tw-items-center"
    >
      <!-- Título -->
      <h1
        class="tw-text-5xl md:tw-text-6xl tw-font-extrabold tw-text-white tw-text-center"
      >
        {project.data.titulo}
      </h1>
      <p class="tw-text-sm tw-text-neutral-500">
        {project.data.fechaInicio}
        {project.data.fechaFin ? ` – ${project.data.fechaFin}` : ""}
      </p>
      <!-- Fechas y Skills -->
      <div
        class="tw-flex tw-flex-col md:tw-flex-row tw-items-center tw-justify-center tw-gap-2"
      >
        {
          project.data.skills && (
            <div class="tw-flex tw-flex-wrap tw-gap-2 tw-justify-center">
              {project.data.skills.map((skill) => (
                <span class="tw-bg-[#5227FF]/30 tw-text-[#B0AFFF] tw-px-3 tw-py-1 tw-rounded-full tw-text-sm">
                  {skill}
                </span>
              ))}
            </div>
          )
        }
      </div>

      <!-- Descripción breve -->
      {
        project.data.descripcion && (
          <p class="tw-text-lg tw-text-neutral-400 tw-text-center tw-max-w-3xl tw-mx-auto tw-leading-relaxed">
            {project.data.descripcion}
          </p>
        )
      }

      <!-- Imagen destacada con tamaño fijo -->
      {
        project.data.imagen && (
          <div class="tw-w-full tw-flex tw-justify-center">
            <div class="tw-h-[20em] tw-w-auto tw-max-w-[40em] tw-rounded-2xl tw-overflow-hidden tw-bg-neutral-900 tw-shadow-2xl tw-flex tw-items-center tw-justify-center">
              <img
                src={project.data.imagen}
                alt={project.data.titulo}
                class="tw-h-full tw-w-auto tw-object-contain tw-rounded-2xl"
              />
            </div>
          </div>
        )
      }

      <!-- Contenido Markdown -->
      <article
        class="tw-prose tw-prose-invert tw-prose-neutral tw-max-w-none tw-leading-relaxed tw-text-neutral-300
               prose-headings:tw-text-white prose-a:tw-text-[#B0AFFF] hover:prose-a:tw-text-[#6a44ff]
               prose-strong:tw-text-white prose-blockquote:tw-border-[#5227FF]/40 prose-blockquote:tw-text-neutral-400
               [&>p]:tw-mb-6 [&_ul]:tw-list-disc [&_ul]:tw-pl-5 [&_ol]:tw-list-decimal [&_ol]:tw-pl-5 [&_li]:tw-mb-2 [&_u]:tw-underline [&_u]:tw-underline-offset-4"
      >
        <Content />
      </article>
    </div>
  </section>
</Layout>
